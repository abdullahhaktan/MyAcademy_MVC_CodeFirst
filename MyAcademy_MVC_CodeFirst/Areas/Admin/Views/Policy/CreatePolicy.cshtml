@model  MyAcademy_MVC_CodeFirst.DTOs.PolicyDtos.CreatePolicyDto

@{
    ViewBag.Title = "Yeni Poliçe Ekle";
    Layout = "~/Areas/Admin/Views/AdminLayout/Index.cshtml";
}

<div class=""></div>

<div class="p-8 max-w-4xl mx-auto font-display">
    <div class="bg-white dark:bg-[#151b2b] rounded-2xl border border-gray-200 dark:border-gray-800 shadow-xl overflow-hidden">
        <div class="p-6 border-b border-gray-200 dark:border-gray-800 bg-green-50/50 dark:bg-green-900/10 flex justify-between items-center">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                <span class="material-symbols-outlined text-green-600">add_circle</span>
                Yeni Poliçe Tanımla
            </h3>
            <button type="button" id="GeminiAi" class="flex items-center gap-2 text-xs font-bold bg-indigo-600 text-white px-3 py-1.5 rounded-full hover:bg-indigo-700 transition-all">
                <span class="material-symbols-outlined text-sm">auto_awesome</span> Gemini ile Öner
            </button>
        </div>
        <div class="p-6">
            @using (Html.BeginForm("CreatePolicy", "Policy", FormMethod.Post))
            {
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-1.5">Poliçe Numarası</label>
                            @Html.TextBoxFor(x => x.PolicyNumber, new { @class = "w-full px-4 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg outline-none focus:border-primary transition-all", placeholder = "Örn: POL-2024-001" })
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-1.5">Sigorta Türü</label>
                            @Html.TextBoxFor(x => x.InsuranceType, new { @class = "w-full px-4 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg outline-none focus:border-primary transition-all", placeholder = "Kasko, Sağlık vb." })
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-1.5">Prim Tutarı (₺)</label>
                            @Html.TextBoxFor(x => x.PremiumAmount, new { @class = "w-full px-4 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg outline-none focus:border-primary transition-all", type = "number", step = "0.01" })
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-1.5">Açıklama / Teminat Detayları</label>
                            @Html.TextAreaFor(x => x.Description, new { @class = "w-full px-4 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg outline-none focus:border-primary transition-all h-32 resize-none", placeholder = "Poliçe Açıklaması" })
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-1.5">Açıklama / Teminat Detayları - 2 (Çok Detaylı Açıklama)</label>
                            @Html.TextAreaFor(x => x.Description1, new { @class = "w-full px-4 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg outline-none focus:border-primary transition-all h-32 resize-none", placeholder = "Gemini tarafından oluşturulacak detaylı metin..." })
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-xl mt-6">
                    @Html.CheckBoxFor(x => x.IsActive, new { @class = "w-5 h-5 text-primary border-gray-300 rounded" })
                    <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 italic">Poliçeyi aktif olarak sisteme işle</label>
                </div>

                <div class="flex gap-3 pt-6">
                    <button type="submit" class="flex-1 bg-primary hover:bg-primary/90 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-primary/20">
                        Poliçeyi Kaydet
                    </button>
                    <a href="/Admin/Policy/Index" class="px-6 py-3 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-200 transition-all text-center no-underline">İptal</a>
                </div>
            }
        </div>
    </div>
    <div id="loadingOverlay" style="
        display:none;
        position:fixed;
        inset:0;
        background:rgba(255,255,255,0.7);
        z-index:9999;
        align-items:center;
        justify-content:center;
    ">
        <div class="spinner-border text-primary" role="status"></div>
    </div>

</div>

@section Scripts{
    <script>
        $(document).ready(function () {

            $('#GeminiAi').on("click", function () {

                var selectedInsuranceType = $("#InsuranceType").val();

                var selectedPremiumAmount = $("#PremiumAmount").val();

                $.ajax({
                    url: '/Admin/Policy/GetAiSuggestion',
                    type: 'POST',
                    data: {
                        selectedInsuranceType: selectedInsuranceType,
                        selectedPremiumAmount: selectedPremiumAmount
                    },

                    beforeSend: function () {
                        $("#loadingOverlay").css("display", "flex");
                        $("#GeminiAi").prop("disabled", true);
                    },

                    success: function (suggestion) {
                        $("#Description1").val(suggestion).fadeOut(50).fadeIn(50);
                    },

                    complete: function () {
                        $("#loadingOverlay").hide();
                        $("#GeminiAi").prop("disabled", false);
                    },

                    error: function () {
                        alert("AI önerisi alınırken hata oluştu");
                    }

                });
            });
        });
    </script>
}